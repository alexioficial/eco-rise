<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#0d6efd">
    <title>EcoRise - {% block title %}{% endblock %}</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/fontawesome/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="icon" href="/static/imgs/bobby.png">

    <style>
        body {
            overflow-x: hidden;
            min-height: 100vh;
        }

        .la_barra .nav-link i {
            transition: filter 0.2s ease;
        }

        .la_barra .nav-link.active i {
            filter: drop-shadow(0 0 6px rgba(25, 135, 84, 0.85)) drop-shadow(0 0 14px rgba(25, 135, 84, 0.55));
            -webkit-filter: drop-shadow(0 0 6px rgba(25, 135, 84, 0.85)) drop-shadow(0 0 14px rgba(25, 135, 84, 0.55));
        }
    </style>
</head>

<body class="bg-light">
    <script>
        (function () {
            function setCookie(name, value, days) {
                const date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                const expires = "; expires=" + date.toUTCString();
                document.cookie = name + "=" + (value || "") + expires + "; path=/; samesite=Lax";
            }

            function getCookie(name) {
                const nameEQ = name + "=";
                const ca = document.cookie.split(';');
                for (let i = 0; i < ca.length; i++) {
                    let c = ca[i];
                    while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                    if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
                }
                return null;
            }

            try {
                const url = new URL(window.location.href);
                const demoParam = url.searchParams.get('demo_mode');

                if (demoParam === '1') {
                    // Persist demo access and clean the URL
                    setCookie('demo_mode', '1', 7);
                    url.searchParams.delete('demo_mode');
                    const cleanUrl = url.pathname + (url.searchParams.toString() ? ('?' + url.searchParams.toString()) : '') + url.hash;
                    window.history.replaceState({}, document.title, cleanUrl);
                } else {
                    // If no cookie, bounce to public site
                    const hasDemo = getCookie('demo_mode') === '1';
                    if (!hasDemo) {
                        window.location.replace('https://eco-rise.surge.sh');
                    }
                }
            } catch (e) {
                // If URL parsing fails for some reason, be conservative and redirect
                if (getCookie('demo_mode') !== '1') {
                    window.location.replace('https://eco-rise.surge.sh');
                }
            }
        })();
    </script>
    <main class="container py-3" style="padding-bottom: 12rem;">
        {% block content %}{% endblock %}
    </main>

    {% set path = request.path %}
    <nav class="la_barra navbar fixed-bottom navbar-light bg-white border-top">
        <div class="container-fluid px-0">
            <div class="d-flex justify-content-around w-100">
                <a href="/VariablesDeInicio"
                    class="nav-link text-center d-flex flex-column align-items-center {{ 'active text-success' if path.startswith('/VariablesDeInicio') else 'text-secondary' }}"
                    aria-label="Initial Variables">
                    <i class="bi bi-sliders fs-5"></i>
                    <span class="small">Variables</span>
                </a>
                <a href="/Principal"
                    class="nav-link text-center d-flex flex-column align-items-center {{ 'active text-success' if path == '/Principal' else 'text-secondary' }}"
                    aria-label="Main">
                    <i class="bi bi-house-door-fill fs-5"></i>
                    <span class="small">Main</span>
                </a>
                <a href="/DatosDeCampo"
                    class="nav-link text-center d-flex flex-column align-items-center {{ 'active text-success' if path.startswith('/DatosDeCampo') else 'text-secondary' }}"
                    aria-label="Field Data">
                    <i class="bi bi-geo-alt fs-5"></i>
                    <span class="small">Field</span>
                </a>
            </div>
        </div>
    </nav>

    <script src="/static/js/jquery-3.7.1.js"></script>
    <script src="/static/js/bootstrap.bundle.min.js"></script>
    <script src="/static/fontawesome/js/all.min.js"></script>
    <script src="/static/js/tools.js"></script>
    {% block scripts %}{% endblock %}
</body>

</html>